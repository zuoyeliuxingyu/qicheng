{% extends 'public/layout.html' %}

{% block body %}
<table class="table table-bordered">
    <caption>
        <button type="button" class="btn btn-info" id="add_group" style="background-color: #00B83F">创建用户组</button>
    </caption>
    <thead>
        <tr>
            <th>#</th>
            <th>group</th>
            <th>operate</th>
        </tr>
    </thead>
    <tbody>
        {% for group_line in object_list %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ group_line.name }}</td>
                <td>
{#                    下面这条，需要urls 做参数处理；views也必须接收参数 在后面的操作会保留，但是不启用#}
{#                    <a type="button" class="btn btn-primary btn-sm member-list" href="{% url 'group_memberlist' group_obj.id %}">成员列表</a>#}
                    <a type="button" class="btn btn-primary btn-sm member-list" href="{% url 'group_userlist' %}?gid={{ group_line.id }}">成员列表</a>
                    <button type="button" class="btn btn-success btn-sm" >查看权限</button>
                    <a  class="btn btn-info btn-sm" href="#">修改权限</a>
                    <button type="button" class="btn btn-danger btn-sm del_group" groupid="{{ group.id }}">删除</button>
                </td>
            </tr>
        {% endfor %}
    </tbody>
</table>

<div class="modal fade" id="create_group" aria-hidden="true">
	<div class="modal-dialog">
	    <div class="modal-content">

            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">×</button>
                <h4>添加group</h4>
            </div>
            <div class="modal-body form-inline">
                <div class="form-group">
                    <label for="exampleInputName2">用户组：</label>
                    <input type="text" class="form-control" id="form_groupname" placeholder="请输入用户组名称" />
                </div>
                <button class="btn btn-primary" id="create_group_btn">提交</button>
            </div>
            <div class="modal-footer">
                <input class="btn btn-default" data-dismiss="modal" aria-hidden="true" type="button" value="取消">
            </div>

        </div>
    </div>
</div>

{% endblock %}

{% block js %}

<script>
$(function () {
    $("#add_group").click(function () {
        var create_group_modal = $("#create_group");
        create_group_modal.modal("show");

        $("#create_group_btn").click(function () {
            var form_groupname_input = $("#form_groupname");
            var gropuname = form_groupname_input.val();
            form_groupname_input.val("");

            if (gropuname == ""){
                swal("添加失败", "组名不能为空", "error");
                return false;
            }

            $.ajax({
                url: "{% url 'create_group' %}",
                type: "post",
                data: {"name": gropuname},
                success: function (res) {
                    if (res.status == 0){
                        swal({
                            "title": "用户组添加成功",
                            "text": "",
                            "type": "success"
                        },function () {
                            setTimeout(function () {
                                window.location.reload();
                            }, 100)
                        });
                    }else {
                        swal("操作失败", res.errmsg, "rrror");
                    }
                },
                beforeSend: function (xhr, settings) {
                        var csrftoken = getCookie('csrftoken');
                        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                            xhr.setRequestHeader("X-CSRFToken", csrftoken)
                        }
                    }
            })

        })
    })
})
</script>
{% endblock %}